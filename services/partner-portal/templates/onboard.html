{% extends "base.html" %}
{% block title %}Partner Onboarding{% endblock %}

{% block nav_links %}
<a href="/api/v1/onboard">Onboard</a>
{% endblock %}

{% block content %}
<h1>Partner Onboarding</h1>
<p>Register your business to sell products on the platform.</p>
<form id="form">
    <label for="business_name">Business Name *</label>
    <input type="text" id="business_name" name="business_name" required>

    <label for="contact_email">Contact Email *</label>
    <input type="email" id="contact_email" name="contact_email" required>

    <label for="business_type">Business Type</label>
    <input type="text" id="business_type" name="business_type" placeholder="e.g. retail, florist">

    <label for="contact_phone">Contact Phone</label>
    <input type="tel" id="contact_phone" name="contact_phone">

    <button type="submit">Create Partner Account</button>
</form>
<div id="message"></div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.getElementById('form').onsubmit = async (e) => {
        e.preventDefault();
        const msg = document.getElementById('message');
        msg.className = '';
        msg.textContent = '';
        try {
            const res = await fetch('/api/v1/onboard', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    business_name: document.getElementById('business_name').value,
                    contact_email: document.getElementById('contact_email').value,
                    business_type: document.getElementById('business_type').value || null,
                    contact_phone: document.getElementById('contact_phone').value || null,
                }),
            });
            const data = await res.json();
            if (res.ok) {
                msg.className = 'success';
                msg.innerHTML = `Partner created! <a href="/api/v1/partners/${data.partner_id}/products">Add products</a> | <a href="/api/v1/partners/${data.partner_id}/settings">Configure webhook</a>`;
            } else {
                msg.className = 'error';
                msg.textContent = data.detail || 'Failed to create partner';
            }
        } catch (err) {
            msg.className = 'error';
            msg.textContent = err.message || 'Request failed';
        }
    };
</script>
{% endblock %}
