<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - {{ partner.business_name }}</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 640px; margin: 2rem auto; padding: 0 1rem; }
        h1 { font-size: 1.5rem; }
        a { color: #2563eb; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { padding: 0.5rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
        label { display: block; margin-top: 1rem; font-weight: 500; }
        input { width: 100%; padding: 0.5rem; margin-top: 0.25rem; box-sizing: border-box; }
        button { margin-top: 1rem; padding: 0.5rem 1.5rem; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; }
        .error { color: #dc2626; margin-top: 0.5rem; }
        .success { color: #16a34a; margin-top: 0.5rem; }
    </style>
</head>
<body>
    <h1>{{ partner.business_name }} - Products</h1>
    <p><a href="/api/v1/partners/{{ partner.id }}/settings">Configure webhook</a></p>
    <h2>Add Product</h2>
    <form id="form">
        <label for="name">Product Name *</label>
        <input type="text" id="name" required>

        <label for="price">Price *</label>
        <input type="number" id="price" step="0.01" min="0" required>

        <label for="description">Description</label>
        <input type="text" id="description" placeholder="Optional">

        <button type="submit">Add Product</button>
    </form>
    <div id="message"></div>
    <h2>Your Products</h2>
    <table>
        <thead><tr><th>Name</th><th>Price</th><th>Currency</th></tr></thead>
        <tbody>
            {% for p in products %}
            <tr><td>{{ p.name }}</td><td>{{ p.price }}</td><td>{{ p.currency }}</td></tr>
            {% else %}
            <tr><td colspan="3">No products yet. Add one above.</td></tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        const partnerId = '{{ partner.id }}';
        document.getElementById('form').onsubmit = async (e) => {
            e.preventDefault();
            const msg = document.getElementById('message');
            msg.className = '';
            msg.textContent = '';
            try {
                const res = await fetch(`/api/v1/partners/${partnerId}/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: document.getElementById('name').value,
                        price: parseFloat(document.getElementById('price').value),
                        description: document.getElementById('description').value || null,
                    }),
                });
                const data = await res.json();
                if (res.ok) {
                    msg.className = 'success';
                    msg.textContent = 'Product added! Refresh to see it.';
                    setTimeout(() => location.reload(), 1000);
                } else {
                    msg.className = 'error';
                    msg.textContent = data.detail || 'Failed to add product';
                }
            } catch (err) {
                msg.className = 'error';
                msg.textContent = err.message || 'Request failed';
            }
        };
    </script>
</body>
</html>
