(()=>{var a={};a.id=2732,a.ids=[2732],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16563:(a,b,c)=>{"use strict";c.d(b,{ConfigEditor:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call ConfigEditor() from the server but ConfigEditor is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/ddwarakanath/Library/Mobile Documents/com~apple~CloudDocs/workspace/AI Universal Service Orchestrator /apps/portal/app/(platform)/platform/config/config-editor.tsx","ConfigEditor")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20546:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(49754),e=c(9117),f=c(46595),g=c(32324),h=c(39326),i=c(38928),j=c(20175),k=c(12),l=c(54290),m=c(12696),n=c(82802),o=c(77533),p=c(45229),q=c(32822),r=c(261),s=c(26453),t=c(52474),u=c(26713),v=c(51356),w=c(62685),x=c(36225),y=c(63446),z=c(2762),A=c(45742),B=c(86439),C=c(81170),D=c.n(C),E=c(62506),F=c(91203),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H={children:["",{children:["(platform)",{children:["platform",{children:["config",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,38410)),"/Users/ddwarakanath/Library/Mobile Documents/com~apple~CloudDocs/workspace/AI Universal Service Orchestrator /apps/portal/app/(platform)/platform/config/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,45126)),"/Users/ddwarakanath/Library/Mobile Documents/com~apple~CloudDocs/workspace/AI Universal Service Orchestrator /apps/portal/app/(platform)/platform/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(c.bind(c,37540)),"/Users/ddwarakanath/Library/Mobile Documents/com~apple~CloudDocs/workspace/AI Universal Service Orchestrator /apps/portal/app/(platform)/layout.tsx"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"],metadata:{icon:[],apple:[],openGraph:[],twitter:[],manifest:"/manifest.webmanifest"}}]},{layout:[()=>Promise.resolve().then(c.bind(c,16953)),"/Users/ddwarakanath/Library/Mobile Documents/com~apple~CloudDocs/workspace/AI Universal Service Orchestrator /apps/portal/app/layout.tsx"],error:[()=>Promise.resolve().then(c.bind(c,41697)),"/Users/ddwarakanath/Library/Mobile Documents/com~apple~CloudDocs/workspace/AI Universal Service Orchestrator /apps/portal/app/error.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,81170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.bind(c,8595)),"/Users/ddwarakanath/Library/Mobile Documents/com~apple~CloudDocs/workspace/AI Universal Service Orchestrator /apps/portal/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"],metadata:{icon:[],apple:[],openGraph:[],twitter:[],manifest:"/manifest.webmanifest"}}]}.children,I=["/Users/ddwarakanath/Library/Mobile Documents/com~apple~CloudDocs/workspace/AI Universal Service Orchestrator /apps/portal/app/(platform)/platform/config/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/(platform)/platform/config/page",pathname:"/platform/config",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/(platform)/platform/config/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(33873).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},27533:(a,b,c)=>{"use strict";c.d(b,{ConfigEditor:()=>i});var d=c(21124),e=c(38301),f=c(63729);function g({models:a,value:b,onChange:c}){let[f,g]=(0,e.useState)(""),[h,i]=(0,e.useState)(!1),j=a.filter(a=>a.name.toLowerCase().includes(f.toLowerCase())||a.id.toLowerCase().includes(f.toLowerCase())),k=a.find(a=>a.id===b);return(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("input",{type:"text",value:h?f:(k?.name??b)||"Select model...",onChange:a=>{g(a.target.value),i(!0)},onFocus:()=>i(!0),onBlur:()=>setTimeout(()=>i(!1),150),placeholder:"Search by name or ID...",className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"}),h&&(0,d.jsx)("ul",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))] py-1",children:j.slice(0,50).map(a=>(0,d.jsxs)("li",{onMouseDown:b=>{b.preventDefault(),c(a.id),g(""),i(!1)},className:"cursor-pointer px-3 py-2 hover:bg-[rgb(var(--color-border))]/50 text-sm",children:[(0,d.jsx)("span",{className:"font-medium",children:a.name}),(0,d.jsxs)("span",{className:"text-[rgb(var(--color-text-secondary))]",children:[" — ",a.id]}),a.pricing&&(0,d.jsxs)("span",{className:"ml-2 text-xs text-[rgb(var(--color-text-secondary))]",children:["\xb7 ",function(a){if(!a)return"";let b=parseFloat(a.prompt??"0"),c=parseFloat(a.completion??"0");if(0===b&&0===c)return"Free";let d=(1e6*b).toFixed(2),e=(1e6*c).toFixed(2);return`$${d}/$${e} per 1M tokens`}(a.pricing)]})]},a.id))})]})}function h(a,b){let c=a.upsell_surge_rules;return{enabled:c?.enabled??!1,upsell_rules:c?.upsell_rules??[],surge_rules:c?.surge_rules??[],promo_rules:c?.promo_rules??[],...b}}function i(){let[a,b]=(0,e.useState)({}),[c,i]=(0,e.useState)(!0),[j,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)(!0),[n,o]=(0,e.useState)(!0),[p,q]=(0,e.useState)(!0),[r,s]=(0,e.useState)(!0),[t,u]=(0,e.useState)(!0),[v,w]=(0,e.useState)(!0),[x,y]=(0,e.useState)(!0),[z,A]=(0,e.useState)(!0),[B,C]=(0,e.useState)(!1),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)("general"),[H,I]=(0,e.useState)([]),[J,K]=(0,e.useState)(!1),[L,M]=(0,e.useState)(null),[N,O]=(0,e.useState)({name:"",api_type:"web_search",base_url:"",api_key:""}),[P,Q]=(0,e.useState)([]),[R,S]=(0,e.useState)(null),[T,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)([]),[X,Y]=(0,e.useState)([]),[Z,$]=(0,e.useState)(!1),[_,aa]=(0,e.useState)({}),[ab,ac]=(0,e.useState)({name:"",provider_type:"azure",endpoint:"",model:"",api_key:""}),ad=(0,e.useCallback)(async()=>{try{let a=await fetch("/api/platform/llm-providers"),b=await a.json();b.detail||Q(Array.isArray(b)?b:[])}catch{Q([])}},[]);(0,e.useCallback)(async()=>{try{let a=await fetch("/api/platform/model-interactions"),b=await a.json();b.detail||Y(Array.isArray(b)?b:[])}catch{Y([])}},[]);let ae=(0,e.useCallback)(async()=>{try{let a=await fetch("/api/platform/external-api-providers"),b=await a.json();b.detail||I(Array.isArray(b)?b:[])}catch{I([])}},[]);async function af(a){b(b=>({...b,active_llm_provider_id:a}));try{await fetch("/api/platform/config",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active_llm_provider_id:a})})}catch{alert("Failed to set active provider")}}async function ag(a){if(confirm("Delete this LLM provider?"))try{let b=await fetch(`/api/platform/llm-providers/${a}`,{method:"DELETE"});if(!b.ok){let a=await b.json();throw Error(a.detail??"Failed")}await ad()}catch(a){alert(a instanceof Error?a.message:"Failed to delete")}}async function ah(){let{name:a,provider_type:b,endpoint:c,model:d,api_key:e}=ab;if(!a||!d)return;let f={name:a,provider_type:b??"azure",model:d};("azure"===b||"custom"===b)&&(f.endpoint=c??""),"openai"===b&&(f.endpoint=null),e&&(f.api_key=e);try{if(R){if(!(await fetch(`/api/platform/llm-providers/${R.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})).ok)throw Error("Failed");S(null)}else{if(!(await fetch("/api/platform/llm-providers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})).ok)throw Error("Failed");U(!1)}ac({name:"",provider_type:"azure",endpoint:"",model:"",api_key:""}),await ad()}catch{alert("Failed to save provider")}}async function ai(){k(!0);try{if(!(await fetch("/api/platform/config",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({commission_rate_pct:a.commission_rate_pct,discovery_relevance_threshold:a.discovery_relevance_threshold,enable_self_registration:a.enable_self_registration,enable_chatgpt:a.enable_chatgpt,feature_flags:a.feature_flags,active_llm_provider_id:a.active_llm_provider_id??null,active_image_provider_id:a.active_image_provider_id??null,llm_temperature:a.llm_temperature,ranking_enabled:a.ranking_enabled,ranking_policy:a.ranking_policy,ranking_edge_cases:a.ranking_edge_cases,sponsorship_pricing:a.sponsorship_pricing,composite_discovery_config:a.composite_discovery_config,enable_composite_bundle_suggestion:a.enable_composite_bundle_suggestion,force_model_based_intent:a.force_model_based_intent,upsell_surge_rules:a.upsell_surge_rules,thinking_ui:a.thinking_ui,thinking_messages:a.thinking_messages})})).ok)throw Error("Failed")}catch{alert("Failed to save")}finally{k(!1)}}return c?(0,d.jsx)("p",{className:"text-[rgb(var(--color-text-secondary))]",children:"Loading..."}):(0,d.jsxs)("div",{className:"space-y-6 max-w-xl",children:[(0,d.jsx)("div",{className:"border-b border-[rgb(var(--color-border))]",children:(0,d.jsx)("div",{className:"flex gap-1 overflow-x-auto",children:[{id:"general",label:"General",description:"Commission, discovery threshold, and feature flags"},{id:"llm",label:"LLM & AI",description:"Providers, image generation, model interactions"},{id:"discovery",label:"Discovery & Ranking",description:"Partner ranking, sponsorship, composite discovery"},{id:"integrations",label:"Integrations",description:"External APIs for events, weather, web search"}].map(a=>(0,d.jsx)("button",{type:"button",onClick:()=>G(a.id),className:`px-4 py-3 text-sm font-medium whitespace-nowrap border-b-2 -mb-px transition-colors ${F===a.id?"border-[rgb(var(--color-primary))] text-[rgb(var(--color-primary))]":"border-transparent text-[rgb(var(--color-text-secondary))] hover:text-[rgb(var(--color-text))] hover:border-[rgb(var(--color-border))]"}`,title:a.description,children:a.label},a.id))})}),"general"===F&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Platform-wide settings: commission rate, discovery relevance threshold, and feature toggles."}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Commission Rate (%)"}),(0,d.jsx)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] mb-1",children:"Default platform commission percentage applied to partner transactions."}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"100",value:a.commission_rate_pct??10,onChange:a=>b(b=>({...b,commission_rate_pct:Number(a.target.value)})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Discovery Relevance Threshold (0–1)"}),(0,d.jsx)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] mb-1",children:"Minimum similarity score for products to appear in discovery. Higher = stricter relevance."}),(0,d.jsx)("input",{type:"number",step:"0.01",min:"0",max:"1",value:a.discovery_relevance_threshold??.7,onChange:a=>b(b=>({...b,discovery_relevance_threshold:Number(a.target.value)})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"self_reg",checked:a.enable_self_registration??!0,onChange:a=>b(b=>({...b,enable_self_registration:a.target.checked}))}),(0,d.jsx)("label",{htmlFor:"self_reg",className:"text-sm",children:"Enable self-registration — Allow new partners to sign up without admin approval."})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"chatgpt",checked:a.enable_chatgpt??!0,onChange:a=>b(b=>({...b,enable_chatgpt:a.target.checked}))}),(0,d.jsx)("label",{htmlFor:"chatgpt",className:"text-sm",children:"Enable ChatGPT integration — Enable ChatGPT/OpenAI for chat experiences."})]})]}),"llm"===F&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"LLM providers, image generation, model interactions, and creativity settings."}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"force_model_intent",checked:a.force_model_based_intent??!1,onChange:a=>b(b=>({...b,force_model_based_intent:a.target.checked}))}),(0,d.jsxs)("label",{htmlFor:"force_model_intent",className:"text-sm",children:["Force model-based intent (ChatGPT/Gemini) — Use LLM only for intent; no heuristic fallback. Ensures probing data (date, budget, preferences) are captured. Requires LLM configured and ChatGPT/Gemini to send ",(0,d.jsx)("code",{className:"text-xs",children:"messages"}),"."]})]}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>o(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["LLM Providers",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:n?"−":"+"})]}),n&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Configure LLM providers (Azure, OpenAI, OpenRouter, etc.) for chat and reasoning. Set one as active."}),P.map(b=>(0,d.jsxs)("div",{className:"flex items-center justify-between gap-4 rounded border border-[rgb(var(--color-border))] p-3",children:[(0,d.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,d.jsx)("span",{className:"font-medium",children:b.name}),(0,d.jsxs)("span",{className:"ml-2 text-sm text-[rgb(var(--color-text-secondary))]",children:[b.provider_type," \xb7 ",b.model]}),a.active_llm_provider_id===b.id&&(0,d.jsx)("span",{className:"ml-2 rounded bg-[rgb(var(--color-primary))]/20 px-2 py-0.5 text-xs",children:"Active"})]}),(0,d.jsxs)("div",{className:"flex shrink-0 gap-2",children:[(0,d.jsx)("button",{type:"button",onClick:()=>af(b.id),className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:"Use this"}),(0,d.jsx)("button",{type:"button",onClick:()=>{S(b),ac({name:b.name,provider_type:b.provider_type,endpoint:b.endpoint??"",model:b.model,api_key:""})},className:"text-sm text-[rgb(var(--color-text-secondary))] hover:underline",children:"Edit"}),(0,d.jsx)("button",{type:"button",onClick:()=>ag(b.id),className:"text-sm text-red-600 hover:underline",children:"Delete"})]})]},b.id)),(R||T||0===P.length)&&(0,d.jsxs)("div",{className:"rounded border border-[rgb(var(--color-border))] p-4 space-y-4",children:[(0,d.jsx)("h4",{className:"font-medium",children:R?"Edit provider":"Add LLM provider"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Name"}),(0,d.jsx)("input",{type:"text",placeholder:"e.g. Production Azure",value:ab.name??"",onChange:a=>ac(b=>({...b,name:a.target.value})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Provider type"}),(0,d.jsxs)("select",{value:ab.provider_type??"azure",onChange:a=>ac(b=>({...b,provider_type:a.target.value})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]",children:[(0,d.jsx)("option",{value:"azure",children:"Azure OpenAI"}),(0,d.jsx)("option",{value:"openai",children:"OpenAI (direct)"}),(0,d.jsx)("option",{value:"gemini",children:"Google Gemini"}),(0,d.jsx)("option",{value:"openrouter",children:"OpenRouter"}),(0,d.jsx)("option",{value:"custom",children:"Custom (OpenAI-compatible)"})]})]}),("azure"===ab.provider_type||"custom"===ab.provider_type)&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Endpoint"}),(0,d.jsx)("input",{type:"url",placeholder:"https://...",value:ab.endpoint??"",onChange:a=>ac(b=>({...b,endpoint:a.target.value})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"API Key"}),(0,d.jsx)("input",{type:"password",placeholder:R?.has_key?"Leave blank to keep existing":"",value:ab.api_key??"",onChange:a=>ac(b=>({...b,api_key:a.target.value})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),"openrouter"===ab.provider_type?(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Model"}),(0,d.jsx)(g,{models:V,value:ab.model??"",onChange:a=>ac(b=>({...b,model:a}))})]}):(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Model"}),(0,d.jsx)("input",{type:"text",placeholder:"e.g. gpt-4o (from Platform Config)",value:ab.model??"",onChange:a=>ac(b=>({...b,model:a.target.value})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(f.$,{onClick:ah,disabled:!ab.name||!ab.model,children:R?"Update":"Add"}),(R||T)&&(0,d.jsx)(f.$,{variant:"outline",onClick:()=>{S(null),U(!1),ac({name:"",provider_type:"azure",endpoint:"",model:"",api_key:""})},children:"Cancel"})]})]}),!R&&!T&&P.length>0&&(0,d.jsx)("button",{type:"button",onClick:()=>{U(!0),ac({name:"",provider_type:"azure",endpoint:"",model:"",api_key:""})},className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:"+ Add another provider"})]})]}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>q(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["Image Generation",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:p?"−":"+"})]}),p&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsxs)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:["Select which provider to use for image generation (e.g. DALL-E 3). Add providers above with model ",(0,d.jsx)("code",{className:"rounded bg-[rgb(var(--color-border))]/50 px-1",children:"dall-e-3"})," ","or similar."]}),P.map(c=>(0,d.jsxs)("div",{className:"flex items-center justify-between gap-4 rounded border border-[rgb(var(--color-border))] p-3",children:[(0,d.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,d.jsx)("span",{className:"font-medium",children:c.name}),(0,d.jsxs)("span",{className:"ml-2 text-sm text-[rgb(var(--color-text-secondary))]",children:[c.provider_type," \xb7 ",c.model]}),a.active_image_provider_id===c.id&&(0,d.jsx)("span",{className:"ml-2 rounded bg-[rgb(var(--color-primary))]/20 px-2 py-0.5 text-xs",children:"Active for images"})]}),(0,d.jsx)("button",{type:"button",onClick:async()=>{b(a=>({...a,active_image_provider_id:c.id}));try{await fetch("/api/platform/config",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active_image_provider_id:c.id})})}catch{alert("Failed to set image provider")}},className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:"Use for images"})]},c.id)),0===P.length&&(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Add an LLM provider above with an image model (e.g. dall-e-3) to enable image generation."})]})]})]}),"integrations"===F&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"External APIs for engagement tools: events, weather, web search. Keys are encrypted."}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>u(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["External APIs (Events, Weather, Web Search)",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:t?"−":"+"})]}),t&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Add external APIs for engagement tools (events, weather, web search). Keys are encrypted. Select which provider to use per type."}),J&&(0,d.jsxs)("div",{className:"rounded border border-[rgb(var(--color-border))] p-4 space-y-3",children:[(0,d.jsx)("h4",{className:"font-medium",children:"Add External API"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Name"}),(0,d.jsx)("input",{type:"text",value:N.name??"",onChange:a=>O(b=>({...b,name:a.target.value})),placeholder:"e.g. Tavily Search",className:"w-full px-3 py-2 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"API Type"}),(0,d.jsxs)("select",{value:N.api_type??"web_search",onChange:a=>O(b=>({...b,api_type:a.target.value})),className:"w-full px-3 py-2 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]",children:[(0,d.jsx)("option",{value:"web_search",children:"Web Search"}),(0,d.jsx)("option",{value:"weather",children:"Weather"}),(0,d.jsx)("option",{value:"events",children:"Events"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Base URL (optional for some APIs)"}),(0,d.jsx)("input",{type:"text",value:N.base_url??"",onChange:a=>O(b=>({...b,base_url:a.target.value})),placeholder:"https://api.tavily.com",className:"w-full px-3 py-2 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"API Key"}),(0,d.jsx)("input",{type:"password",value:N.api_key??"",onChange:a=>O(b=>({...b,api_key:a.target.value})),placeholder:"Your API key",className:"w-full px-3 py-2 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(f.$,{onClick:async()=>{try{if(!(await fetch("/api/platform/external-api-providers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:N.name,api_type:N.api_type,base_url:N.base_url||void 0,api_key:N.api_key||void 0})})).ok)throw Error("Failed");K(!1),O({name:"",api_type:"web_search",base_url:"",api_key:""}),ae()}catch{alert("Failed to add external API")}},children:"Save"}),(0,d.jsx)(f.$,{variant:"outline",onClick:()=>K(!1),children:"Cancel"})]})]}),H.map(c=>(0,d.jsx)("div",{className:"rounded border border-[rgb(var(--color-border))] overflow-hidden",children:L===c.id?(0,d.jsxs)("div",{className:"p-4 space-y-3",children:[(0,d.jsx)("h4",{className:"font-medium",children:"Edit External API"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Name"}),(0,d.jsx)("input",{type:"text",value:N.name??c.name,onChange:a=>O(b=>({...b,name:a.target.value})),placeholder:"e.g. Tavily Search",className:"w-full px-3 py-2 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"API Type"}),(0,d.jsxs)("select",{value:N.api_type??c.api_type,onChange:a=>O(b=>({...b,api_type:a.target.value})),className:"w-full px-3 py-2 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]",children:[(0,d.jsx)("option",{value:"web_search",children:"Web Search"}),(0,d.jsx)("option",{value:"weather",children:"Weather"}),(0,d.jsx)("option",{value:"events",children:"Events"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Base URL (optional)"}),(0,d.jsx)("input",{type:"text",value:N.base_url??c.base_url??"",onChange:a=>O(b=>({...b,base_url:a.target.value})),placeholder:"https://api.example.com",className:"w-full px-3 py-2 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"API Key (leave empty to keep current)"}),(0,d.jsx)("input",{type:"password",value:N.api_key??"",onChange:a=>O(b=>({...b,api_key:a.target.value})),placeholder:"••••••••",className:"w-full px-3 py-2 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(f.$,{onClick:async()=>{try{let a=(N.base_url??c.base_url??"").trim(),b={name:N.name??c.name,api_type:N.api_type??c.api_type,base_url:a||null};if(N.api_key&&(b.api_key=N.api_key),!(await fetch(`/api/platform/external-api-providers/${c.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).ok)throw Error("Failed");M(null),O({name:"",api_type:"web_search",base_url:"",api_key:""}),ae()}catch{alert("Failed to update external API")}},children:"Save"}),(0,d.jsx)(f.$,{variant:"outline",onClick:()=>{M(null),O({name:"",api_type:"web_search",base_url:"",api_key:""})},children:"Cancel"})]})]}):(0,d.jsxs)("div",{className:"flex items-center justify-between gap-4 p-3",children:[(0,d.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,d.jsx)("span",{className:"font-medium",children:c.name}),(0,d.jsxs)("span",{className:"ml-2 text-sm text-[rgb(var(--color-text-secondary))]",children:[c.api_type,c.base_url&&` \xb7 ${c.base_url}`]}),a.active_external_api_ids?.[c.api_type]===c.id&&(0,d.jsxs)("span",{className:"ml-2 rounded bg-[rgb(var(--color-primary))]/20 px-2 py-0.5 text-xs",children:["Active for ",c.api_type]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[(0,d.jsxs)("button",{type:"button",onClick:async()=>{let d={...a.active_external_api_ids??{},[c.api_type]:c.id};b(a=>({...a,active_external_api_ids:d}));try{await fetch("/api/platform/config",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active_external_api_ids:d})})}catch{alert("Failed to set external API")}},className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:["Use for ",c.api_type]}),(0,d.jsx)("button",{type:"button",onClick:()=>{K(!1),O({name:c.name,api_type:c.api_type,base_url:c.base_url??"",api_key:""}),M(c.id)},className:"text-sm text-[rgb(var(--color-text-secondary))] hover:underline",children:"Edit"}),(0,d.jsx)("button",{type:"button",onClick:async()=>{if(confirm(`Delete "${c.name}"? This cannot be undone.`))try{if(!(await fetch(`/api/platform/external-api-providers/${c.id}`,{method:"DELETE"})).ok)throw Error("Failed");if(a.active_external_api_ids?.[c.api_type]===c.id){let d={...a.active_external_api_ids??{}};delete d[c.api_type],b(a=>({...a,active_external_api_ids:d})),await fetch("/api/platform/config",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active_external_api_ids:d})})}M(null),ae()}catch{alert("Failed to delete external API")}},className:"text-sm text-red-600 hover:underline",children:"Delete"})]})]})},c.id)),!J&&!L&&(0,d.jsx)("button",{type:"button",onClick:()=>{M(null),K(!0)},className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:"+ Add external API"})]})]})]}),"llm"===F&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>s(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["Model Interactions",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:r?"−":"+"})]}),r&&(0,d.jsxs)("div",{className:"mt-4 space-y-6",children:[(0,d.jsxs)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:["Edit system prompts per interaction type. Changes apply without redeployment. Empty prompt uses code default. Use ",(0,d.jsx)("strong",{children:"Try"})," to test each interaction with the active model—verifies connection and helps tweak prompts. For discover types, the test sends sample product data (Product data, Allowed CTAs) in the same format as real chat."]}),X.map(a=>(0,d.jsxs)("div",{className:"rounded border border-[rgb(var(--color-border))] p-4 space-y-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"font-medium",children:a.display_name}),(0,d.jsx)("span",{className:"ml-2 text-xs text-[rgb(var(--color-text-secondary))]",children:a.interaction_type})]}),(0,d.jsx)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] bg-[rgb(var(--color-border))]/20 rounded px-2 py-1.5",children:a.when_used}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"System prompt"}),(0,d.jsx)("textarea",{rows:6,value:a.system_prompt??"",onChange:b=>{let c=b.target.value;Y(b=>b.map(b=>b.interaction_type===a.interaction_type?{...b,system_prompt:c||null}:b))},placeholder:"Leave empty to use code default",className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))] font-mono text-sm"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,d.jsxs)("label",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:a.enabled,onChange:b=>Y(c=>c.map(c=>c.interaction_type===a.interaction_type?{...c,enabled:b.target.checked}:c))}),(0,d.jsx)("span",{className:"text-sm",children:"Enabled"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("label",{className:"text-sm",children:"Max tokens"}),(0,d.jsx)("input",{type:"number",min:50,max:4e3,value:a.max_tokens,onChange:b=>{let c=parseInt(b.target.value,10);Number.isNaN(c)||Y(b=>b.map(b=>b.interaction_type===a.interaction_type?{...b,max_tokens:Math.max(50,Math.min(4e3,c))}:b))},className:"w-20 px-2 py-1 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsx)(f.$,{type:"button",variant:"outline",size:"sm",disabled:_[a.interaction_type]?.loading,onClick:async()=>{aa(b=>({...b,[a.interaction_type]:{loading:!0}}));try{let b=await fetch("/api/platform/model-interactions/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({interaction_type:a.interaction_type,system_prompt_override:a.system_prompt||void 0})}),c=await b.json().catch(()=>({}));b.ok?aa(b=>({...b,[a.interaction_type]:{response:c.response,error:void 0}})):aa(b=>({...b,[a.interaction_type]:{error:c.detail||"Test failed"}}))}catch{aa(b=>({...b,[a.interaction_type]:{error:"Request failed"}}))}},children:_[a.interaction_type]?.loading?"Testing...":"Try"})]}),_[a.interaction_type]?.response&&(0,d.jsxs)("div",{className:"mt-3 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]/50 p-3",children:[(0,d.jsx)("p",{className:"text-xs font-medium text-[rgb(var(--color-text-secondary))] mb-1",children:"Model response"}),(0,d.jsx)("pre",{className:"text-sm whitespace-pre-wrap break-words font-sans",children:_[a.interaction_type].response})]}),_[a.interaction_type]?.error&&(0,d.jsxs)("div",{className:"mt-3 rounded border border-red-500/50 bg-red-500/10 p-3",children:[(0,d.jsx)("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mb-1",children:"Error"}),(0,d.jsx)("p",{className:"text-sm",children:_[a.interaction_type].error})]})]},a.id)),(0,d.jsx)(f.$,{onClick:async()=>{$(!0);try{if(!(await fetch("/api/platform/model-interactions",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:X.map(a=>({interaction_type:a.interaction_type,system_prompt:a.system_prompt||null,enabled:a.enabled,max_tokens:a.max_tokens}))})})).ok)throw Error("Failed")}catch{alert("Failed to save model interactions")}finally{$(!1)}},disabled:Z||0===X.length,children:Z?"Saving...":"Save Model Interactions"})]})]}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>m(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["Model settings",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:l?"−":"+"})]}),l&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Control creativity (temperature) for the active LLM provider."}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Creativity (0–1)"}),(0,d.jsx)("input",{type:"range",min:"0",max:"1",step:"0.05",value:a.llm_temperature??.1,onChange:a=>b(b=>({...b,llm_temperature:Number(a.target.value)})),className:"w-full"}),(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:(a.llm_temperature??.1).toFixed(2)}),(0,d.jsx)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] mt-1",children:"Lower = more deterministic; higher = more creative. Applies to the active LLM provider."})]})]})]})]}),"discovery"===F&&(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Partner ranking weights, sponsorship pricing, and composite discovery (date night, bundles)."}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>w(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["Partner Ranking",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:v?"−":"+"})]}),v&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Configure how partners are ranked in search results. Weight price, rating, commission, and trust."}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"ranking_enabled",checked:a.ranking_enabled??!0,onChange:a=>b(b=>({...b,ranking_enabled:a.target.checked}))}),(0,d.jsx)("label",{htmlFor:"ranking_enabled",children:"Enable partner ranking"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Strategy"}),(0,d.jsx)("select",{value:a.ranking_policy?.strategy??"weighted",onChange:a=>b(b=>({...b,ranking_policy:{...b.ranking_policy,strategy:a.target.value}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]",children:(0,d.jsx)("option",{value:"weighted",children:"Weighted (price, rating, commission, trust)"})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Price weight"}),(0,d.jsx)("input",{type:"number",step:"0.1",min:"0",max:"1",value:a.ranking_policy?.weights?.price??.3,onChange:a=>b(b=>({...b,ranking_policy:{...b.ranking_policy,weights:{...b.ranking_policy?.weights,price:Number(a.target.value)}}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Rating weight"}),(0,d.jsx)("input",{type:"number",step:"0.1",min:"0",max:"1",value:a.ranking_policy?.weights?.rating??.3,onChange:a=>b(b=>({...b,ranking_policy:{...b.ranking_policy,weights:{...b.ranking_policy?.weights,rating:Number(a.target.value)}}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Commission weight"}),(0,d.jsx)("input",{type:"number",step:"0.1",min:"0",max:"1",value:a.ranking_policy?.weights?.commission??.2,onChange:a=>b(b=>({...b,ranking_policy:{...b.ranking_policy,weights:{...b.ranking_policy?.weights,commission:Number(a.target.value)}}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Trust weight"}),(0,d.jsx)("input",{type:"number",step:"0.1",min:"0",max:"1",value:a.ranking_policy?.weights?.trust??.2,onChange:a=>b(b=>({...b,ranking_policy:{...b.ranking_policy,weights:{...b.ranking_policy?.weights,trust:Number(a.target.value)}}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Price direction"}),(0,d.jsxs)("select",{value:a.ranking_policy?.price_direction??"asc",onChange:a=>b(b=>({...b,ranking_policy:{...b.ranking_policy,price_direction:a.target.value}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]",children:[(0,d.jsx)("option",{value:"asc",children:"Lower price = better rank"}),(0,d.jsx)("option",{value:"desc",children:"Higher price = better rank"})]})]}),(0,d.jsxs)("div",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:["Edge cases: missing_rating=",a.ranking_edge_cases?.missing_rating??.5,", missing_commission=",a.ranking_edge_cases?.missing_commission??0,", missing_trust=",a.ranking_edge_cases?.missing_trust??.5]})]})]}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>y(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["Sponsorship",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:x?"−":"+"})]}),x&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Configure sponsored product placement and pricing per day. Partners pay to boost visibility."}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"sponsorship_enabled",checked:a.sponsorship_pricing?.sponsorship_enabled??!0,onChange:a=>b(b=>({...b,sponsorship_pricing:{...b.sponsorship_pricing,sponsorship_enabled:a.target.checked}}))}),(0,d.jsx)("label",{htmlFor:"sponsorship_enabled",children:"Enable product sponsorship"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Price per day (cents)"}),(0,d.jsx)("input",{type:"number",min:"0",value:a.sponsorship_pricing?.product_price_per_day_cents??1e3,onChange:a=>b(b=>({...b,sponsorship_pricing:{...b.sponsorship_pricing,product_price_per_day_cents:Number(a.target.value)}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"}),(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"($10/day default)"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Max sponsored per query"}),(0,d.jsx)("input",{type:"number",min:"0",max:"20",value:a.sponsorship_pricing?.max_sponsored_per_query??3,onChange:a=>b(b=>({...b,sponsorship_pricing:{...b.sponsorship_pricing,max_sponsored_per_query:Number(a.target.value)}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]})]})]}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>A(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["Composite Discovery (Date Night, Bundles)",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:z?"−":"+"})]}),z&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Products per category for composite experiences (e.g. date night: flowers, dinner, movies)."}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Products per category"}),(0,d.jsx)("input",{type:"number",min:"1",max:"10",value:a.composite_discovery_config?.products_per_category??5,onChange:a=>b(b=>({...b,composite_discovery_config:{...b.composite_discovery_config,products_per_category:Math.max(1,Math.min(10,Number(a.target.value)||5))}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"}),(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"(1–10, default 5)"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"composite-sponsorship",checked:a.composite_discovery_config?.sponsorship_enabled??!0,onChange:a=>b(b=>({...b,composite_discovery_config:{...b.composite_discovery_config,sponsorship_enabled:a.target.checked}})),className:"rounded border border-[rgb(var(--color-border))]"}),(0,d.jsx)("label",{htmlFor:"composite-sponsorship",className:"text-sm",children:"Apply sponsorship boost when ranking composite results"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"enable-bundle-suggestion",checked:a.enable_composite_bundle_suggestion??!0,onChange:a=>b(b=>({...b,enable_composite_bundle_suggestion:a.target.checked})),className:"rounded border border-[rgb(var(--color-border))]"}),(0,d.jsx)("label",{htmlFor:"enable-bundle-suggestion",className:"text-sm",children:"Enable LLM bundle suggestions (2–4 options per composite experience)"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Product Mix (slices by sort, % of results)"}),(0,d.jsx)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] mb-2",children:"Mix products from different sort criteria. Percentages should sum to 100."}),(a.composite_discovery_config?.product_mix??[]).map((a,c)=>(0,d.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[(0,d.jsxs)("select",{value:a.sort,onChange:a=>b(b=>({...b,composite_discovery_config:{...b.composite_discovery_config,product_mix:(b.composite_discovery_config?.product_mix??[]).map((b,d)=>d===c?{...b,sort:a.target.value}:b)}})),className:"flex-1 px-2 py-1.5 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))] text-sm",children:[(0,d.jsx)("option",{value:"price_desc",children:"Price (high → low)"}),(0,d.jsx)("option",{value:"price_asc",children:"Price (low → high)"}),(0,d.jsx)("option",{value:"rating",children:"Rating"}),(0,d.jsx)("option",{value:"popularity",children:"Popularity (most sold)"}),(0,d.jsx)("option",{value:"sponsored",children:"Sponsored"}),(0,d.jsx)("option",{value:"recent",children:"Recent"})]}),(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Top"}),(0,d.jsx)("input",{type:"number",min:"1",max:"50",value:a.limit,onChange:a=>b(b=>({...b,composite_discovery_config:{...b.composite_discovery_config,product_mix:(b.composite_discovery_config?.product_mix??[]).map((b,d)=>d===c?{...b,limit:Math.max(1,Math.min(50,Number(a.target.value)||10))}:b)}})),className:"w-14 px-2 py-1.5 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))] text-sm"}),(0,d.jsx)("input",{type:"number",min:"0",max:"100",value:a.pct,onChange:a=>b(b=>({...b,composite_discovery_config:{...b.composite_discovery_config,product_mix:(b.composite_discovery_config?.product_mix??[]).map((b,d)=>d===c?{...b,pct:Math.max(0,Math.min(100,Number(a.target.value)||0))}:b)}})),className:"w-16 px-2 py-1.5 rounded border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))] text-sm"}),(0,d.jsx)("span",{className:"text-sm",children:"%"}),(0,d.jsx)("button",{type:"button",onClick:()=>b(a=>({...a,composite_discovery_config:{...a.composite_discovery_config,product_mix:(a.composite_discovery_config?.product_mix??[]).filter((a,b)=>b!==c)}})),className:"text-red-500 hover:underline text-sm",children:"Remove"})]},c)),(0,d.jsx)("button",{type:"button",onClick:()=>b(a=>({...a,composite_discovery_config:{...a.composite_discovery_config,product_mix:[...a.composite_discovery_config?.product_mix??[],{sort:"price_desc",limit:10,pct:20}]}})),className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:"+ Add slice"}),(()=>{let b=(a.composite_discovery_config?.product_mix??[]).reduce((a,b)=>a+(b.pct??0),0);return 100!==b&&(a.composite_discovery_config?.product_mix??[]).length>0?(0,d.jsxs)("p",{className:"text-xs text-amber-600 mt-1",children:["Percentages sum to ",b,"% (should be 100%)"]}):null})()]})]})]}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>C(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["Upsell & Surge Rules",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:B?"−":"+"})]}),B&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Configure upsell add-ons, surge pricing, and promotional products at discount when added before checkout. Rules are evaluated after intent resolution."}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"upsell_surge_enabled",checked:a.upsell_surge_rules?.enabled??!1,onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{enabled:a.target.checked})}))}),(0,d.jsx)("label",{htmlFor:"upsell_surge_enabled",children:"Enable upsell and surge rules"})]}),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Upsell rules"}),(0,d.jsx)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] mb-2",children:"Suggest add-on categories when intent matches. Conditions: intent_types (discover_composite, discover_products), occasion_contains (keywords), purchase_intent_min (exploring|considering|ready_to_buy)."}),(a.upsell_surge_rules?.upsell_rules??[]).map((a,c)=>(0,d.jsxs)("div",{className:"mb-4 p-3 rounded border border-[rgb(var(--color-border))] space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("input",{type:"text",placeholder:"Rule name",value:a.name??"",onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{upsell_rules:(b.upsell_surge_rules?.upsell_rules??[]).map((b,d)=>d===c?{...b,name:a.target.value}:b)})})),className:"flex-1 px-2 py-1 text-sm rounded border border-[rgb(var(--color-border))] mr-2"}),(0,d.jsx)("button",{type:"button",onClick:()=>b(a=>({...a,upsell_surge_rules:h(a,{upsell_rules:(a.upsell_surge_rules?.upsell_rules??[]).filter((a,b)=>b!==c)})})),className:"text-red-600 text-sm hover:underline",children:"Remove"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,d.jsx)("input",{type:"text",placeholder:"Intent types (comma)",value:(a.conditions?.intent_types??[]).join(", "),onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{upsell_rules:(b.upsell_surge_rules?.upsell_rules??[]).map((b,d)=>d===c?{...b,conditions:{...b.conditions,intent_types:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]"}),(0,d.jsx)("input",{type:"text",placeholder:"Occasion keywords (comma)",value:(a.conditions?.occasion_contains??[]).join(", "),onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{upsell_rules:(b.upsell_surge_rules?.upsell_rules??[]).map((b,d)=>d===c?{...b,conditions:{...b.conditions,occasion_contains:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]"}),(0,d.jsxs)("select",{value:a.conditions?.purchase_intent_min??"",onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{upsell_rules:(b.upsell_surge_rules?.upsell_rules??[]).map((b,d)=>d===c?{...b,conditions:{...b.conditions,purchase_intent_min:a.target.value||void 0}}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]",children:[(0,d.jsx)("option",{value:"",children:"Any intent"}),(0,d.jsx)("option",{value:"exploring",children:"Exploring"}),(0,d.jsx)("option",{value:"considering",children:"Considering"}),(0,d.jsx)("option",{value:"ready_to_buy",children:"Ready to buy"})]}),(0,d.jsx)("input",{type:"text",placeholder:"Addon categories (comma)",value:(a.addon_categories??[]).join(", "),onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{upsell_rules:(b.upsell_surge_rules?.upsell_rules??[]).map((b,d)=>d===c?{...b,addon_categories:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))] col-span-2"}),(0,d.jsxs)("label",{className:"flex items-center gap-2 col-span-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:a.boost_in_results??!1,onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{upsell_rules:(b.upsell_surge_rules?.upsell_rules??[]).map((b,d)=>d===c?{...b,boost_in_results:a.target.checked}:b)})}))}),"Boost addons in results"]})]})]},a.id??c)),(0,d.jsx)("button",{type:"button",onClick:()=>b(a=>({...a,upsell_surge_rules:h(a,{upsell_rules:[...a.upsell_surge_rules?.upsell_rules??[],{id:crypto.randomUUID(),name:"",conditions:{},addon_categories:[],boost_in_results:!1}]})})),className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:"+ Add upsell rule"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Surge rules"}),(0,d.jsx)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] mb-2",children:"Apply surge pricing when intent matches. Conditions: intent_types, purchase_intent_min, urgency_signals (comma)."}),(a.upsell_surge_rules?.surge_rules??[]).map((a,c)=>(0,d.jsxs)("div",{className:"mb-4 p-3 rounded border border-[rgb(var(--color-border))] space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("input",{type:"text",placeholder:"Rule name",value:a.name??"",onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{surge_rules:(b.upsell_surge_rules?.surge_rules??[]).map((b,d)=>d===c?{...b,name:a.target.value}:b)})})),className:"flex-1 px-2 py-1 text-sm rounded border border-[rgb(var(--color-border))] mr-2"}),(0,d.jsx)("button",{type:"button",onClick:()=>b(a=>({...a,upsell_surge_rules:h(a,{surge_rules:(a.upsell_surge_rules?.surge_rules??[]).filter((a,b)=>b!==c)})})),className:"text-red-600 text-sm hover:underline",children:"Remove"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,d.jsx)("input",{type:"number",placeholder:"Surge %",value:a.surge_pct??0,onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{surge_rules:(b.upsell_surge_rules?.surge_rules??[]).map((b,d)=>d===c?{...b,surge_pct:Number(a.target.value)||0}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]"}),(0,d.jsx)("input",{type:"number",placeholder:"Max surge %",value:a.max_surge_pct??"",onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{surge_rules:(b.upsell_surge_rules?.surge_rules??[]).map((b,d)=>d===c?{...b,max_surge_pct:a.target.value?Number(a.target.value):void 0}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]"}),(0,d.jsxs)("select",{value:a.conditions?.purchase_intent_min??"",onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{surge_rules:(b.upsell_surge_rules?.surge_rules??[]).map((b,d)=>d===c?{...b,conditions:{...b.conditions,purchase_intent_min:a.target.value||void 0}}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]",children:[(0,d.jsx)("option",{value:"",children:"Any intent"}),(0,d.jsx)("option",{value:"exploring",children:"Exploring"}),(0,d.jsx)("option",{value:"considering",children:"Considering"}),(0,d.jsx)("option",{value:"ready_to_buy",children:"Ready to buy"})]}),(0,d.jsx)("input",{type:"text",placeholder:"Intent types (comma)",value:(a.conditions?.intent_types??[]).join(", "),onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{surge_rules:(b.upsell_surge_rules?.surge_rules??[]).map((b,d)=>d===c?{...b,conditions:{...b.conditions,intent_types:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]"}),(0,d.jsx)("input",{type:"text",placeholder:"Urgency signals (comma)",value:(a.conditions?.urgency_signals??[]).join(", "),onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{surge_rules:(b.upsell_surge_rules?.surge_rules??[]).map((b,d)=>d===c?{...b,conditions:{...b.conditions,urgency_signals:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))] col-span-2"})]})]},a.id??c)),(0,d.jsx)("button",{type:"button",onClick:()=>b(a=>({...a,upsell_surge_rules:h(a,{surge_rules:[...a.upsell_surge_rules?.surge_rules??[],{id:crypto.randomUUID(),name:"",conditions:{},surge_pct:0}]})})),className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:"+ Add surge rule"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Promo rules"}),(0,d.jsx)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] mb-2",children:"Suggest products at discount before checkout. trigger: before_checkout, min_bundle_items."}),(a.upsell_surge_rules?.promo_rules??[]).map((a,c)=>(0,d.jsxs)("div",{className:"mb-4 p-3 rounded border border-[rgb(var(--color-border))] space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("input",{type:"text",placeholder:"Rule name",value:a.name??"",onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{promo_rules:(b.upsell_surge_rules?.promo_rules??[]).map((b,d)=>d===c?{...b,name:a.target.value}:b)})})),className:"flex-1 px-2 py-1 text-sm rounded border border-[rgb(var(--color-border))] mr-2"}),(0,d.jsx)("button",{type:"button",onClick:()=>b(a=>({...a,upsell_surge_rules:h(a,{promo_rules:(a.upsell_surge_rules?.promo_rules??[]).filter((a,b)=>b!==c)})})),className:"text-red-600 text-sm hover:underline",children:"Remove"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,d.jsx)("input",{type:"number",placeholder:"Discount %",value:a.discount_pct??0,onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{promo_rules:(b.upsell_surge_rules?.promo_rules??[]).map((b,d)=>d===c?{...b,discount_pct:Number(a.target.value)||0}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]"}),(0,d.jsx)("input",{type:"number",placeholder:"Min bundle items",value:a.conditions?.min_bundle_items??0,onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{promo_rules:(b.upsell_surge_rules?.promo_rules??[]).map((b,d)=>d===c?{...b,conditions:{...b.conditions,trigger:"before_checkout",min_bundle_items:Number(a.target.value)||0}}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]"}),(0,d.jsx)("input",{type:"text",placeholder:"Intent types (comma)",value:(a.conditions?.intent_types??[]).join(", "),onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{promo_rules:(b.upsell_surge_rules?.promo_rules??[]).map((b,d)=>d===c?{...b,conditions:{...b.conditions,intent_types:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))]"}),(0,d.jsx)("input",{type:"text",placeholder:"Product IDs (comma)",value:(a.product_ids??[]).join(", "),onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{promo_rules:(b.upsell_surge_rules?.promo_rules??[]).map((b,d)=>d===c?{...b,product_ids:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))] col-span-2"}),(0,d.jsx)("input",{type:"text",placeholder:"Category queries (comma)",value:(a.category_queries??[]).join(", "),onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{promo_rules:(b.upsell_surge_rules?.promo_rules??[]).map((b,d)=>d===c?{...b,category_queries:a.target.value.split(",").map(a=>a.trim()).filter(Boolean)}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))] col-span-2"}),(0,d.jsx)("input",{type:"text",placeholder:"Promo message",value:a.promo_message??"",onChange:a=>b(b=>({...b,upsell_surge_rules:h(b,{promo_rules:(b.upsell_surge_rules?.promo_rules??[]).map((b,d)=>d===c?{...b,promo_message:a.target.value}:b)})})),className:"px-2 py-1 rounded border border-[rgb(var(--color-border))] col-span-2"})]})]},a.id??c)),(0,d.jsx)("button",{type:"button",onClick:()=>b(a=>({...a,upsell_surge_rules:h(a,{promo_rules:[...a.upsell_surge_rules?.promo_rules??[],{id:crypto.randomUUID(),name:"",conditions:{trigger:"before_checkout",min_bundle_items:0},discount_pct:0}]})})),className:"text-sm text-[rgb(var(--color-primary))] hover:underline",children:"+ Add promo rule"})]})]})]})]}),(0,d.jsxs)("div",{className:"border border-[rgb(var(--color-border))] rounded-md p-4",children:[(0,d.jsxs)("button",{type:"button",onClick:()=>E(a=>!a),className:"flex items-center justify-between w-full text-left font-medium",children:["Thinking Progress",(0,d.jsx)("span",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:D?"−":"+"})]}),D&&(0,d.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))]",children:"Display settings for thinking progress messages shown while the chat is loading. Font size, color, and animation."}),(0,d.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Font size (px)"}),(0,d.jsx)("input",{type:"number",min:12,max:24,value:a.thinking_ui?.font_size_px??14,onChange:a=>b(b=>({...b,thinking_ui:{...b.thinking_ui,font_size_px:Math.max(12,Math.min(24,Number(a.target.value)||14))}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Color"}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("input",{type:"color",value:a.thinking_ui?.color??"#94a3b8",onChange:a=>b(b=>({...b,thinking_ui:{...b.thinking_ui,color:a.target.value}})),className:"h-10 w-14 rounded border border-[rgb(var(--color-border))] cursor-pointer"}),(0,d.jsx)("input",{type:"text",value:a.thinking_ui?.color??"#94a3b8",onChange:a=>b(b=>({...b,thinking_ui:{...b.thinking_ui,color:a.target.value}})),className:"flex-1 px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]})]})]}),(0,d.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Animation"}),(0,d.jsxs)("select",{value:a.thinking_ui?.animation_type??"dots",onChange:a=>b(b=>({...b,thinking_ui:{...b.thinking_ui,animation_type:a.target.value}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]",children:[(0,d.jsx)("option",{value:"dots",children:"Dots"}),(0,d.jsx)("option",{value:"pulse",children:"Pulse"}),(0,d.jsx)("option",{value:"fade",children:"Fade"}),(0,d.jsx)("option",{value:"none",children:"None"})]})]}),(a.thinking_ui?.animation_type==="pulse"||a.thinking_ui?.animation_type==="fade")&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Animation speed (ms)"}),(0,d.jsx)("input",{type:"number",min:200,max:3e3,step:100,value:a.thinking_ui?.animation_speed_ms??1e3,onChange:a=>b(b=>({...b,thinking_ui:{...b.thinking_ui,animation_speed_ms:Math.max(200,Math.min(3e3,Number(a.target.value)||1e3))}})),className:"w-full px-3 py-2 rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm mb-1",children:"Thinking message overrides"}),(0,d.jsxs)("p",{className:"text-xs text-[rgb(var(--color-text-secondary))] mb-2",children:["Override default messages per step. Keys: intent_resolved, before_complete_probing, before_handle_unrelated, before_weather, after_weather, before_occasions, before_discover_products, before_discover_composite, after_discover, before_bundle, before_response. Use ","{location}",", ","{query}",", ","{experience_name}"," for dynamic values."]}),(0,d.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:["intent_resolved","before_complete_probing","before_handle_unrelated","before_weather","after_weather","before_occasions","before_discover_products","before_discover_composite","after_discover","before_bundle","before_response"].map(c=>(0,d.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-xs w-44 shrink-0 text-[rgb(var(--color-text-secondary))] truncate",title:c,children:c}),(0,d.jsx)("input",{type:"text",placeholder:"Leave empty for default",value:a.thinking_messages?.[c]??"",onChange:a=>b(b=>({...b,thinking_messages:{...b.thinking_messages,[c]:a.target.value}})),className:"flex-1 px-3 py-1.5 text-sm rounded-md border border-[rgb(var(--color-border))] bg-[rgb(var(--color-background))]"})]},c))})]})]})]})]}),(0,d.jsx)(f.$,{onClick:ai,disabled:j,children:j?"Saving...":"Save"})]})}},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{"use strict";a.exports=require("path")},38410:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>h});var d=c(75338),e=c(50698),f=c(82161),g=c(16563);async function h(){let{userId:a}=await (0,e.j)();return a||(0,f.redirect)("/platform/login"),(0,d.jsxs)("main",{className:"max-w-[var(--content-max-width)] mx-auto px-6 py-8",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Algorithms & Config"}),(0,d.jsx)("p",{className:"text-sm text-[rgb(var(--color-text-secondary))] mb-6",children:"Configure LLM providers, ranking, discovery, sponsorship, and external integrations."}),(0,d.jsx)(g.ConfigEditor,{})]})}},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},49210:(a,b,c)=>{Promise.resolve().then(c.bind(c,16563))},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:a=>{"use strict";a.exports=require("node:fs")},76760:a=>{"use strict";a.exports=require("node:path")},77598:a=>{"use strict";a.exports=require("node:crypto")},83490:(a,b,c)=>{Promise.resolve().then(c.bind(c,27533))},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[5745,698,6802,4225,5801,8324],()=>b(b.s=20546));module.exports=c})();